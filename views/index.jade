html
    head
        title Scorll
        - if (release)
            link(rel="stylesheet", rel="stylesheet", href="/release/#{revision}/dijit/themes/claro/claro.css")
        - else
            link(rel="stylesheet", rel="stylesheet", href="/dijit/themes/claro/claro.css")
        link(type="text/css", rel="stylesheet", href="/css/main.css") 
        link(type="text/css", rel="stylesheet", href="/css/stage.css") 
        script(type="text/javascript", language="javascript")
          // <![CDATA[
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-24385457-1']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
          // ]]>
    body.claro
        div#stage-container
            h1#title Loading...
            div#stage
            div(style="margin: 5px;")
                div#newAssetButton(dojoType="dijit.form.Button") Add New Asset
                div#pasteAssetButton(dojoType="dijit.form.Button",
                    style="display:none") Paste
        - if (release)
            script(src="/release/#{revision}/dojo/dojo.js", type="text/javascript", djConfig="parseOnLoad: true")
            script(src="/release/#{revision}/dojo/scorll.js", type="text/javascript", djConfig="parseOnLoad: true")
        - else
            script(src="/dojo/dojo.js", type="text/javascript", djConfig="parseOnLoad: true")
        script(src="/socket.io/socket.io.js")
        script(type="text/javascript", language="javascript")
            // <![CDATA[
            dojo.require("scorll.content.Content");
            dojo.require("scorll.net.Client");
            dojo.require("scorll.net.User");
            dojo.require("scorll.stage.Stage");
            dojo.require("scorll.asset.NewAssetForm");
            dojo.addOnLoad(
                function() {
                    var clientArgs = {
                        groupId: '#{contentId}'
                    };
                    var contentArgs = {
                        id: '#{contentId}'
                    };
                    var args = {
                        client: new scorll.net.Client(clientArgs),
                        user: new scorll.net.User(),
                        content: new scorll.content.Content(contentArgs),
                        requireLogin: false,
                    };
                    var stage = new scorll.stage.Stage(args);
                    var newAssetButton = dijit.byId("newAssetButton");
                    var pasteAssetButton = dijit.byId("pasteAssetButton");
                    dojo.connect(newAssetButton, "onClick", function() {
                        var newAssetButton = this;
                        dojo.fadeOut({node: newAssetButton.domNode}).play();
                        dojo.fadeOut({node: pasteAssetButton.domNode}).play();
                        var form = new scorll.asset.NewAssetForm(
                          {stage: stage});
                        form.placeAt(dojo.byId("stage"));
                        dojo.connect(form, "onSubmit", function() {
                          dojo.fadeIn({node: newAssetButton.domNode}).play();
                          dojo.fadeIn({node: pasteAssetButton.domNode}).play();
                          form.destroyRecursive();
                        });
                        dojo.connect(form, "onCancel", function() {
                          dojo.fadeIn({node: newAssetButton.domNode}).play();
                          dojo.fadeIn({node: pasteAssetButton.domNode}).play();
                          form.destroyRecursive();
                        });
                    });
                    dojo.connect(pasteAssetButton, "onClick", function() {
                        stage.paste();
                    });
                    dojo.connect(stage, "onClipboard", function() {
                        if(stage.cutObject || stage.copyObject) {
                            pasteAssetButton.domNode.style['display'] =
                            "inline-block";
                        } else {
                            pasteAssetButton.domNode.style['display'] = "none";
                        }
                    });
                }
            );
            // ]]>
